{% extends "base.html" %}

{% block title %}External Customer Invoice{% endblock %}
{% block header_title %}Invoice Creation{% endblock %}

{% block additional_css %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/external_invoices.css') }}">
{% endblock %}

{% block content %}
<div class="invoice-content">
    <form id="invoice-form" method="post">
        <div class="invoice-top">
            <!-- Customer Information Section -->
            <div class="customer-info">
                <h3>Customer Information</h3>
                <label for="customer-id">Customer ID:</label>
                <input type="text" id="customer-id" name="customer_id" value="{{ customer.id }}" readonly>
                
                <label for="customer-name">Customer Name:</label>
                <input type="text" id="customer-name" name="customer_name" value="{{ customer.full_name }}" readonly>
                
                <label for="contact-details">Contact Details:</label>
                <input type="text" id="contact-details" name="contact_details" value="{{ customer.contact_number }}" readonly>
                
                <label for="billing-address">Billing Address:</label>
                <input type="text" id="billing-address" name="billing_address" value="{{ customer.address }}">
            </div>

            <!-- Invoice Summary Section -->
            <div class="invoice-summary">
                <h3 class="receipt-title">Invoice Summary</h3>
                <div class="receipt-summary">
                    <div class="receipt-item">
                        <span class="label">Subtotal:</span>
                        <span class="value" id="subtotal">0</span>
                    </div>
                    <div class="receipt-item">
                        <span class="label">Discounts:</span>
                        <span class="value" id="discounts">0</span>
                    </div>
                    <div class="receipt-item">
                        <span class="label">Tax:</span>
                        <span class="value" id="tax">0</span>
                    </div>
                    <div class="receipt-item total">
                        <span class="label">Total Amount Due:</span>
                        <span class="value" id="total-amount">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Medicines Details Section -->
        <h3>Medicines Purchased</h3>
        <table id="medicines-table">
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Quantity</th>
                    <th>Cost per Item</th>
                    <th>Total Cost</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="text" name="medicine_description[]" placeholder="Paracetamol"></td>
                    <td><input type="number" name="medicine_quantity[]" placeholder="1"></td>
                    <td><input type="number" name="medicine_cost[]" placeholder="10"></td>
                    <td><input type="number" name="medicine_total[]" placeholder="10" readonly></td>
                </tr>
            </tbody>
        </table>

        <!-- Action Buttons -->
        <div class="actions">
            <button type="submit" name="action" value="draft" class="actionbts">Save Invoice as Draft</button>
            <button type="submit" name="action" value="finalize" class="actionbts">Submit and Finalize Invoice</button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/external_invoices.js') }}"></script>
<script>
    function addRow(tableId) {
        var table = document.getElementById(tableId);
        var newRow = table.insertRow(-1);
        var cells = table.rows[0].cells;
        for (var i = 0; i < cells.length - 1; i++) {
            var cell = newRow.insertCell(i);
            var input = document.createElement('input');
            input.type = 'text';
            input.name = tableId + '_description[]';
            input.placeholder = 'New Item';
            cell.appendChild(input);
        }
        var removeCell = newRow.insertCell(cells.length - 1);
        removeCell.innerHTML = '<button type="button" onclick="removeRow(this)">Remove</button>';
    }

    function removeRow(button) {
        var row = button.parentNode.parentNode;
        row.parentNode.removeChild(row);
    }
</script>
{% endblock %}
